@inherits AppComponentBase;

@if (IsMenuOpen)
{
    <div class="menu-overlay" @onclick=CloseMenu></div>
}

@{
    var imageUrl = user.ProfileImageName is null ? null : $"{profileImageUrl}&file={user.ProfileImageName}";
}

<section class="@(IsMenuOpen ? null : "closed")" Style="@($"--nav-menu-width:{(isNavToggled ? "4rem" : "14rem")}")">
    <BitCard Class="panel" Style="@($"--nav-menu-padding:{(isNavToggled ? "0.5rem" : "0.75rem")}")">
        <BitStack>
            <BitStack Horizontal AutoHeight HorizontalAlign="BitAlignment.Center">
                <BitImage Src="_content/Boilerplate.Client.Core/images/bit-logo.svg"
                          Visibility="@(isNavToggled ? BitVisibility.Collapsed : BitVisibility.Visible)" />
                <BitSpacer Visibility="@(isNavToggled ? BitVisibility.Collapsed : BitVisibility.Visible)" />
                <BitButton IconOnly
                           FixedColor
                           OnClick="ToggleNavMenu"
                           Variant="BitVariant.Text"
                           Color="BitColor.TertiaryBackground"
                           IconName="@BitIconName.ColumnRightTwoThirds" />
            </BitStack>

            <BitSeparator />

            <BitPersona Class="persona"
                        ImageUrl="@imageUrl"
                        OnImageClick=GoToProfile
                        PrimaryText="@user.FullName"
                        SecondaryText="@user.DisplayName"
                        Presence="BitPersonaPresence.Online"
                        Size="@(isNavToggled ? BitPersonaSize.Size32 : BitPersonaSize.Size48)">
                <ImageOverlayTemplate>
                    <span>@Localizer[nameof(AppStrings.Edit)]</span>
                </ImageOverlayTemplate>
            </BitPersona>

            <BitSeparator />

            <BitNav FullWidth
                    Items="navItems"
                    IconOnly="isNavToggled"
                    DefaultSelectedItem="navItems[0]"
                    Styles="@(new() { SelectedItemContainer = "background-color: var(--bit-clr-bg-sec-active)" })"
                    OnItemClick="(BitNavItem item) => HandleNavItemClick(item)">
            </BitNav>

            <BitSpacer />

            <BitActionButton OnClick="DoSignOut"
                             Style="width:fit-content"
                             IconName="@BitIconName.SignOut"
                             Title="@Localizer[nameof(AppStrings.SignOut)]">
                @(isNavToggled ? "" : Localizer[nameof(AppStrings.SignOut)])
            </BitActionButton>
        </BitStack>
    </BitCard>
</section>

<SignOutConfirmModal @bind-IsOpen=isSignOutModalOpen></SignOutConfirmModal>