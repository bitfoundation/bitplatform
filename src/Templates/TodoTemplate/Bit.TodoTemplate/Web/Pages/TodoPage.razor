@page "/todo"
@attribute [Authorize]

@inherits AppComponentBase;

<PageTitle>@TodoStrings.ResourceManager.Translate(TodoStrings.TodoTitle)</PageTitle>

<div class="page-container">
    <div class="page-content--white">
        <div class="search-box-container">
            <BitSearchBox OnChange="TodoItemSearch"
                          OnClear="@(()=>TodoItemSearch(""))"
                          Style="width: 300px"
                          Placeholder="@TodoStrings.ResourceManager.Translate(TodoStrings.TodoSearchPlaceholder)" />
        </div>
        <div class="todo-content">
            <h1 class="main-title">@TodoStrings.ResourceManager.Translate(TodoStrings.TodoTitle)</h1>
            <div class="add-todo-container">
                <BitTextField @bind-Value="NewTodoItemTitle"
                              Placeholder="@TodoStrings.ResourceManager.Translate(TodoStrings.TodoAddPlaceholder)"
                              Class="add-todo-input" />
                <BitButton OnClick="WrapHandled(AddTodoItem)"
                           Class="add-todo-button"
                           Title="@TodoStrings.ResourceManager.Translate(TodoStrings.Add)"
                           AriaLabel="@TodoStrings.ResourceManager.Translate(TodoStrings.Add)"
                           IsEnabled="(string.IsNullOrEmpty(NewTodoItemTitle) is false)">
                    @if (IsAddLoading)
                    {
                        <BitSpinner Size="BitSpinnerSize.Small"></BitSpinner>
                    }
                    else
                    {
                        <span>@TodoStrings.ResourceManager.Translate(TodoStrings.Add)</span>
                    }
                </BitButton>
            </div>
            <div class="todo-list-container">
                <div class="filter-container">
                    <BitPivot Class="filter-pivot" OnLinkClick="NavigatePivotItem">
                        <BitPivotItem Class="todo-pivot-tab" HeaderText="@TodoStrings.ResourceManager.Translate(TodoStrings.All)" AriaLabel="@TodoStrings.ResourceManager.Translate(TodoStrings.All)" />
                        <BitPivotItem Class="todo-pivot-tab" HeaderText="@TodoStrings.ResourceManager.Translate(TodoStrings.Active)" AriaLabel="@TodoStrings.ResourceManager.Translate(TodoStrings.Active)" />
                        <BitPivotItem Class="todo-pivot-tab" HeaderText="@TodoStrings.ResourceManager.Translate(TodoStrings.Completed)" AriaLabel="@TodoStrings.ResourceManager.Translate(TodoStrings.Completed)" />
                    </BitPivot>
                    <div class="sort-drp-container">
                        <BitDropDown OnSelectItem="TodoItemSort"
                                     Class="sort-todo-drp"
                                     Items="SortItemList">
                            <CaretDownFragment>
                                <BitActionButton IconName="BitIconName.Sort">@TodoStrings.ResourceManager.Translate(TodoStrings.SortBy) @SelectedSortTodoItemName</BitActionButton>
                            </CaretDownFragment>
                        </BitDropDown>
                    </div>
                </div>
                <div class="todo-list">
                    @if (IsLoading)
                    {
                        <div class="todo-list-spinner">
                            <BitSpinner></BitSpinner>
                        </div>
                    }
                    else
                    {
                        if (ViewTodoItemList?.Count == 0)
                        {
                            <div class="todo-list--empty-state">
                                <img src="/images/backgrounds/empty-todo-list-bg.svg">
                                <BitLabel>@TodoStrings.ResourceManager.Translate(TodoStrings.NoTodos)No todos yet</BitLabel>
                            </div>
                        }
                        else
                        {
                            <BitBasicList Style="width: 100%; height: inherit"
                                  Items="ViewTodoItemList"
                                  Virtualize="true">
                                <RowTemplate>
                                    <div class="todo-item" role="listitem">
                                        @if (context.IsInEditMode)
                                {
                                    <BitTextField Class="todo-input" @bind-Value="context.Title" />
                                    <div class="todo-item-btn-group--edit-mode">
                                                <BitButton Title="@TodoStrings.ResourceManager.Translate(TodoStrings.Edit)"
                                               AriaLabel="@TodoStrings.ResourceManager.Translate(TodoStrings.Edit)"
                                               OnClick="WrapHandled(() => EditTodoItem(context))">@TodoStrings.ResourceManager.Translate(TodoStrings.Edit)</BitButton>
                                        <BitButton ButtonStyle="BitButtonStyle.Standard"
                                               Class="todo-button"
                                               Title="@TodoStrings.ResourceManager.Translate(TodoStrings.Cancel)"
                                               AriaLabel="@TodoStrings.ResourceManager.Translate(TodoStrings.Cancel)"
                                               OnClick="WrapHandled(() => CancelEditMode(context))">@TodoStrings.ResourceManager.Translate(TodoStrings.Cancel)</BitButton>
                                    </div>
                                }
                                else
                                {
                                    <div class="todo-info">
                                        <BitCheckbox DefaultValue="context.IsDone"
                                                 OnChange="()=>ToggleTodoItem(context)">
                                            @context.Title
                                        </BitCheckbox>

                                        <div Class="todo-item-date">
                                            @context.Date.ToString("MMMM dd , yyyy , dddd")
                                        </div>
                                    </div>
                                    <div class="todo-btn-group">
                                        <BitIconButton IconName="BitIconName.Edit"
                                                   Title="@TodoStrings.ResourceManager.Translate(TodoStrings.Edit)"
                                                   AriaLabel="@TodoStrings.ResourceManager.Translate(TodoStrings.Edit)"
                                                   OnClick="WrapHandled(() => ToggleToEditMode(context))" />

                                        <BitIconButton IconName="BitIconName.Delete"
                                                   Title="@TodoStrings.ResourceManager.Translate(TodoStrings.Remove)"
                                                   AriaLabel="@TodoStrings.ResourceManager.Translate(TodoStrings.Remove)"
                                                   OnClick="WrapHandled(() => DeleteTodoItem(context))" />
                                    </div>
                                }
                            </div>
                        </RowTemplate>
                    </BitBasicList>
                        }
                    }
                </div>
            </div>
        </div>
    </div>
</div>
