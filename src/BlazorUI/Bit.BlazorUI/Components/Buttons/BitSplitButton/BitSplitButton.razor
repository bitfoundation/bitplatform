@namespace Bit.BlazorUI
@inherits BitComponentBase
@typeparam TItem

@if (ChildContent is not null)
{
    <CascadingValue Value="this" IsFixed="true">
        @ChildContent
    </CascadingValue>
}

<div @ref="RootElement" @attributes="HtmlAttributes"
     style="@StyleBuilder.Value"
     class="@ClassBuilder.Value"
     id="@UniqueId">
    <button @onclick="() => HandleOnClick(_currentItem)"
            aria-label="@AriaLabel"
            aria-hidden="@AriaHidden"
            aria-describedby="@AriaDescription"
            type="@_buttonType.GetValue()"
            tabindex="@(IsEnabled ? 0 : -1)"
            style="@GetStyle(_currentItem) @ClassStyles?.ItemButton?.Style"
            class="bit-spl-opb @(GetIsEnabled(_currentItem) ? "" : "bit-dis") @GetClass(_currentItem) @ClassStyles?.ItemButton?.Class">
        @if (_currentItem is not null)
        {
            var template = GetTemplate(_currentItem);
            if (template is not null)
            {
                @template(_currentItem)
            }
            else if (ItemTemplate is not null)
            {
                @ItemTemplate(_currentItem)
            }

            var iconName = GetIconName(_currentItem);
            @if (iconName.HasValue())
            {
                <i style="@ClassStyles?.ItemIcon?.Style" class="bit-icon bit-icon--@iconName @ClassStyles?.ItemIcon?.Class" />
            }
            <span style="@ClassStyles?.ItemText?.Style" class="bit-spl-txt @ClassStyles?.ItemText?.Class">
                @GetText(_currentItem)
            </span>
        }
    </button>

    <span class="bit-spl-spb"></span>

    <button @onclick="OpenCallout"
            type="button"
            tabindex="@(IsEnabled ? 0 : -1)"
            style="@ClassStyles?.ChevronDownButton?.Style"
            class="bit-spl-chb @ClassStyles?.ChevronDownButton?.Class">
        <i style="@ClassStyles?.ChevronDownIcon?.Style" class="bit-icon bit-icon--@ChevronDownIcon @ClassStyles?.ChevronDownIcon?.Class" />
    </button>

    <div @onclick="CloseCallout" @onclick:stopPropagation
         style="display:@(_isCalloutOpen ? "block" : "none") @ClassStyles?.Overlay?.Style"
         class="bit-spl-ovl"></div>

    <div id="@_calloutId"
         style="@ClassStyles?.Callout?.Style"
         class="bit-spl-cal @ClassStyles?.Callout?.Class">
        <ul role="presentation">
            @foreach (TItem item in _items)
            {
                if (item == _currentItem) continue;

                var isEnabled = GetIsEnabled(item);
                var template = GetTemplate(item);
                <li role="presentation">
                    <button @onclick="() => HandleOnItemClick(item)"
                            role="menuitem"
                            aria-disabled="@isEnabled"
                            type="@_buttonType.GetValue()"
                            tabindex="@(isEnabled ? 0 : -1)"
                            style="@GetStyle(item) @ClassStyles?.ItemButton?.Style"
                            class="bit-spl-itm @(isEnabled ? "" : "bit-dis") @GetClass(item) @ClassStyles?.ItemButton?.Class">
                        @if (template is not null)
                        {
                            @template(item)
                        }
                        else if (ItemTemplate is not null)
                        {
                            @ItemTemplate(item)
                        }
                        else
                        {
                            var iconName = GetIconName(item);
                            @if (iconName.HasValue())
                            {
                                <i style="@ClassStyles?.ItemIcon?.Style" class="bit-icon bit-icon--@iconName @ClassStyles?.ItemIcon?.Class" />
                            }
                            <span style="@ClassStyles?.ItemText?.Style" class="bit-spl-txt @ClassStyles?.ItemText?.Class">
                                @GetText(item)
                            </span>
                        }
                    </button>
                </li>
            }
        </ul>
    </div>
</div>
